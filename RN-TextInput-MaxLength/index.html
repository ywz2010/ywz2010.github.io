<!DOCTYPE html><html lang="zh-cn"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="ä¸€ä¸ªåŒ—æ¼‚iOSå¼€å‘è€…çš„webä¹‹è·¯"><title>textInputMaxLength | è®°å½•ç”Ÿæ´»~</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">textInputMaxLength</h1><a id="logo" href="/.">æ™“æ˜­</a><p class="description">ywzçš„åšå®¢</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">textInputMaxLength</h1><div class="post-meta">May 21, 2016<span> | </span><span class="category"><a href="/categories/iOS/">iOS</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>æœ‰ä¸šåŠ¡çº¿çš„åŒäº‹æåˆ°<code>ReactNative</code>çš„<code>TextInput</code>ç»„ä»¶å­˜åœ¨ä¸€ä¸ªbugï¼Œä¸­æ–‡è¾“å…¥æ³•é€šè¿‡ä¸åœç‚¹å‡»è”æƒ³è¯è¯­å¯ä»¥çªç ´<code>MaxLength</code>å±æ€§çš„é™åˆ¶ã€‚äºæ˜¯å¼€å§‹ç ”ç©¶ä¿®å¤è¿™ä¸ªbugã€‚</p>
<h2 id="æ‰¾å‡ºbugçš„åŸå› "><a href="#æ‰¾å‡ºbugçš„åŸå› " class="headerlink" title="æ‰¾å‡ºbugçš„åŸå› "></a>æ‰¾å‡ºbugçš„åŸå› </h2><p>è¦ä¿®å¤bugé¦–å…ˆéœ€è¦ç¡®è®¤bugå‡ºç°çš„æ¡ä»¶ï¼Œæµ‹è¯•å‘ç°åªæœ‰ä½¿ç”¨<code>iOS</code>ç³»ç»Ÿé»˜è®¤çš„ä¸­æ–‡<strong>æ‹¼éŸ³</strong>è¾“å…¥æ³•çš„è”æƒ³åŠŸèƒ½æ‰ä¼šçªç ´<code>TextInput</code>çš„<code>MaxLength</code>é™åˆ¶ã€‚å…¶ä»–è¾“å…¥æ³•æ¯”å¦‚é»˜è®¤çš„ä¸­æ–‡ç¬”ç”»è¾“å…¥ã€æœç‹—è¾“å…¥æ³•ç­‰éƒ½ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚   </p>
<p>æŸ¥çœ‹<code>ReactNative</code>çš„æºç å‘ç°ï¼Œé™åˆ¶<code>TextInput</code>è¾“å…¥é•¿åº¦çš„æ˜¯åœ¨<code>RCTTextFieldManager</code>å¯¹æ¯ä¸ª<code>RCTTextField</code>çš„ä¸‹åˆ—å›è°ƒä¸­å¤„ç†çš„ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)textField:(RCTTextField *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Only allow single keypresses for onKeyPress, pasted text will not be sent.</span></span><br><span class="line">  <span class="keyword">if</span> (textField.textWasPasted) &#123;</span><br><span class="line">    textField.textWasPasted = <span class="literal">NO</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    [textField sendKeyValueForString:string];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (textField.maxLength == <span class="literal">nil</span> || [string isEqualToString:<span class="string">@"\n"</span>]) &#123;  <span class="comment">// Make sure forms can be submitted via return</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">NSUInteger</span> allowedLength = textField.maxLength.integerValue - textField.text.length + range.length;</span><br><span class="line">  <span class="keyword">if</span> (string.length &gt; allowedLength) &#123;</span><br><span class="line">    <span class="keyword">if</span> (string.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// Truncate the input string so the result is exactly maxLength</span></span><br><span class="line">      <span class="built_in">NSString</span> *limitedString = [string substringToIndex:allowedLength];</span><br><span class="line">      <span class="built_in">NSMutableString</span> *newString = textField.text.mutableCopy;</span><br><span class="line">      [newString replaceCharactersInRange:range withString:limitedString];</span><br><span class="line">      textField.text = newString;</span><br><span class="line">      <span class="comment">// Collapse selection at end of insert to match normal paste behavior</span></span><br><span class="line">      <span class="built_in">UITextPosition</span> *insertEnd = [textField positionFromPosition:textField.beginningOfDocument</span><br><span class="line">                                                          offset:(range.location + allowedLength)];</span><br><span class="line">      textField.selectedTextRange = [textField textRangeFromPosition:insertEnd toPosition:insertEnd];</span><br><span class="line">      [textField textFieldDidChange];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ä½¿ç”¨é»˜è®¤çš„ä¸­æ–‡æ‹¼éŸ³çš„è”æƒ³è¾“å…¥çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šèµ°è¿™ä¸ª<code>delegate</code>ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯ç®—ç³»ç»Ÿçš„bugå§ï¼Œå› ä¸ºæµ‹è¯•å‘ç°<code>UITextFieldDelegate</code>çš„æ‰€æœ‰æ–¹æ³•åœ¨æ­¤æ—¶å‡ä¸ä¼šè°ƒç”¨ï¼Œå› æ­¤ä½¿ç”¨<code>UITextFieldDelegate</code>å¹¶ä¸èƒ½å»é™åˆ¶é»˜è®¤ä¸­æ–‡è¾“å…¥æ³•çš„è”æƒ³è¾“å…¥é•¿åº¦ã€‚   </p>
<p>çœ‹æ¥åªæœ‰ä»å¦å¤–çš„æ¸ é“å»åˆ¤æ–­è¾“å…¥çš„å­—ç¬¦æ˜¯å¦è¶…è¿‡é•¿åº¦ï¼Œå¥½åœ¨è¿™ç§æƒ…å†µä¼šè§¦å‘<code>UIControlEventEditingChanged</code>ï¼Œå› æ­¤å¯ä»¥åœ¨<code>RCTTextField</code>çš„<code>textFieldDidChange</code>æ–¹æ³•ä¸­é™åˆ¶è¾“å…¥çš„é•¿åº¦ï¼Œå¦‚æœè¾“å…¥çš„é•¿åº¦è¿‡é•¿åˆ™æˆªå–ã€‚</p>
<h2 id="å¦å¤–çš„é—®é¢˜"><a href="#å¦å¤–çš„é—®é¢˜" class="headerlink" title="å¦å¤–çš„é—®é¢˜"></a>å¦å¤–çš„é—®é¢˜</h2><h3 id="æ‹¼éŸ³è¾“å…¥çš„é•¿åº¦é—®é¢˜"><a href="#æ‹¼éŸ³è¾“å…¥çš„é•¿åº¦é—®é¢˜" class="headerlink" title="æ‹¼éŸ³è¾“å…¥çš„é•¿åº¦é—®é¢˜"></a>æ‹¼éŸ³è¾“å…¥çš„é•¿åº¦é—®é¢˜</h3><p>åœ¨<code>RCTTextField</code>çš„<code>textFieldDidChange</code>æ–¹æ³•ä¸­é™åˆ¶è¾“å…¥çš„é•¿åº¦ï¼Œå¯ä»¥è§£å†³é»˜è®¤ä¸­æ–‡è”æƒ³è¾“å…¥è¿‡é•¿çš„é—®é¢˜ï¼Œä½†æ˜¯è‡ªå·±æµ‹è¯•å°±å‘ç°äº†å¦å¤–çš„é—®é¢˜ğŸ˜³<br>ä¸­æ–‡è¾“å…¥çš„æ—¶å€™æ‰“çš„æ‹¼éŸ³ä¼šè¢«ç®—åˆ°<code>text</code>çš„é•¿åº¦ä¸­ï¼Œè¿™æ ·å°±å¯¼è‡´äº†å¦‚æœåªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦çš„æ—¶å€™åªèƒ½æ‰“ä¸€ä¸ªæ‹¼éŸ³å­—æ¯äº†ğŸ˜‚</p>
<p>ç½‘ä¸Šæœç´¢å‘ç°ä¸­æ–‡çš„blogå¯¹é™åˆ¶<code>UITextField</code>é•¿åº¦çš„æ—¶å€™éƒ½è€ƒè™‘è¿‡æ‹¼éŸ³å­—æ¯çš„é—®é¢˜ï¼Œä¸ä¼šç»Ÿè®¡æ‹¼éŸ³å­—æ¯åˆ°å­—ç¬¦çš„é•¿åº¦ä¸­ã€‚</p>
<h3 id="è¡¨æƒ…æˆªå–çš„é—®é¢˜ğŸ˜ƒ"><a href="#è¡¨æƒ…æˆªå–çš„é—®é¢˜ğŸ˜ƒ" class="headerlink" title="è¡¨æƒ…æˆªå–çš„é—®é¢˜ğŸ˜ƒ"></a>è¡¨æƒ…æˆªå–çš„é—®é¢˜ğŸ˜ƒ</h3><p>è¿˜æœ‰ä¸ªå…³é”®çš„é—®é¢˜å°±æ˜¯è¡¨æƒ…çš„æˆªå–é—®é¢˜ï¼Œæ¯ä¸ªè¡¨æƒ…ğŸ˜„éƒ½æ˜¯å ç”¨çš„2ä¸ªå­—ç¬¦ï¼Œç®€å•ç²—æš´çš„æˆªå–å°±ä¼šæ‚²å‰§ğŸ˜±</p>
<p>ç½‘ä¸Šéƒ½æœ‰å¾ˆå¤šè¿™ç§ç±»å‹çš„blogï¼Œåªèƒ½è¯´ä¸‹é¢çš„è¿™ä¸ªæ–¹æ³•çœŸå¥½ä½¿ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">self</span>.text = [<span class="keyword">self</span>.text substringToIndex:_maxLength.unsignedIntegerValue];</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">NSRange</span> range = <span class="built_in">NSMakeRange</span>(<span class="number">0</span>, _maxLength.unsignedIntegerValue);</span><br><span class="line"><span class="built_in">NSRange</span> textRange = [<span class="keyword">self</span>.text rangeOfComposedCharacterSequencesForRange:range];</span><br><span class="line"><span class="keyword">self</span>.text = [<span class="keyword">self</span>.text substringWithRange:textRange];</span><br></pre></td></tr></table></figure></p>
<h3 id="å¦å¤–çš„å‘"><a href="#å¦å¤–çš„å‘" class="headerlink" title="å¦å¤–çš„å‘"></a>å¦å¤–çš„å‘</h3><p>å½“ç„¶å®˜æ–¹çš„è¿˜æœ‰å¤§å‘ï¼Œåœ¨åˆ¤æ–­è¾“å…¥å­—ç¬¦çš„æ˜¯å¦è¶…è¿‡çš„é™åˆ¶çš„æ—¶å€™ï¼Œ<code>allowedLength</code>æ˜¯è¿™æ ·æ±‚çš„ï¼š<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSUInteger</span> allowedLength = textField.maxLength.integerValue - textField.text.length + range.length;</span><br></pre></td></tr></table></figure></p>
<p>è¿™ä¸ª<code>allowedLength</code>å› ä¸ºæ˜¯æ— ç¬¦å·çš„ï¼Œæ‰€ä»¥æœ¬æ¥åº”è¯¥æ˜¯è´Ÿæ•°çš„ä¼šå˜çš„å¾ˆå¤§å¾ˆå¤§å¥½ä¹ˆğŸ˜‚<br>å¦‚æœ<code>TextInput</code>é»˜è®¤è®¾ç½®å­—ç¬¦çš„é•¿åº¦è¶…è¿‡äº†<code>MaxLength</code>ï¼Œç„¶åå°±å¯ä»¥å„ç§ç©è€è¾“å…¥äº†ğŸ˜‚</p>
<p>ä¿®è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ä¸€å®šå¾—æ³¨æ„å¦‚æœé»˜è®¤å­—ç¬¦è¶…å‡ºé•¿åº¦çš„è¯å¾—å…è®¸åˆ é™¤ï¼Œä¸è¦é—®æˆ‘ä¸ºå•¥çŸ¥é“ğŸ˜‚ğŸ˜‚ğŸ˜‚</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.1" async></script><a data-url="http://wenzhao.in/RN-TextInput-MaxLength/" data-id="ciogzepcl000146it0i65napv" class="article-share-link">åˆ†äº«åˆ°</a><div class="tags"><a href="/tags/iOS/">iOS</a><a href="/tags/ReactNative/">ReactNative</a></div><div class="post-nav"><a href="/first-hexo-day/" class="next">æŠ˜è…¾Hexoçš„ç¬¬ä¸€å¤©</a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://wenzhao.in"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Life/">Life</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/ReactNative/" style="font-size: 15px;">ReactNative</a> <a href="/tags/life/" style="font-size: 15px;">life</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€æ–°æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/RN-TextInput-MaxLength/">textInputMaxLength</a></li><li class="post-list-item"><a class="post-list-link" href="/first-hexo-day/">æŠ˜è…¾Hexoçš„ç¬¬ä¸€å¤©</a></li><li class="post-list-item"><a class="post-list-link" href="/hello-world/">ç¬¬ä¸€ç¯‡</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Â© <a href="/." rel="nofollow">è®°å½•ç”Ÿæ´»~.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.1"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>