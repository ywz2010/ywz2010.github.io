<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>记录生活~</title>
  <subtitle>ywz的博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://wenzhao.in/"/>
  <updated>2016-05-21T09:58:27.000Z</updated>
  <id>http://wenzhao.in/</id>
  
  <author>
    <name>Yin Wenzhao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>textInputMaxLength</title>
    <link href="http://wenzhao.in/RN-TextInput-MaxLength/"/>
    <id>http://wenzhao.in/RN-TextInput-MaxLength/</id>
    <published>2016-05-21T08:29:06.000Z</published>
    <updated>2016-05-21T09:58:27.000Z</updated>
    
    <content type="html">&lt;p&gt;有业务线的同事提到&lt;code&gt;ReactNative&lt;/code&gt;的&lt;code&gt;TextInput&lt;/code&gt;组件存在一个bug，中文输入法通过不停点击联想词语可以突破&lt;code&gt;MaxLength&lt;/code&gt;属性的限制。于是开始研究修复这个bug。&lt;/p&gt;
&lt;h2 id=&quot;找出bug的原因&quot;&gt;&lt;a href=&quot;#找出bug的原因&quot; class=&quot;headerlink&quot; title=&quot;找出bug的原因&quot;&gt;&lt;/a&gt;找出bug的原因&lt;/h2&gt;&lt;p&gt;要修复bug首先需要确认bug出现的条件，测试发现只有使用&lt;code&gt;iOS&lt;/code&gt;系统默认的中文&lt;strong&gt;拼音&lt;/strong&gt;输入法的联想功能才会突破&lt;code&gt;TextInput&lt;/code&gt;的&lt;code&gt;MaxLength&lt;/code&gt;限制。其他输入法比如默认的中文笔画输入、搜狗输入法等都不会出现这种情况。   &lt;/p&gt;
&lt;p&gt;查看&lt;code&gt;ReactNative&lt;/code&gt;的源码发现，限制&lt;code&gt;TextInput&lt;/code&gt;输入长度的是在&lt;code&gt;RCTTextFieldManager&lt;/code&gt;对每个&lt;code&gt;RCTTextField&lt;/code&gt;的下列回调中处理的：&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)textField:(RCTTextField *)textField shouldChangeCharactersInRange:(&lt;span class=&quot;built_in&quot;&gt;NSRange&lt;/span&gt;)range replacementString:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)string&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// Only allow single keypresses for onKeyPress, pasted text will not be sent.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (textField.textWasPasted) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    textField.textWasPasted = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    [textField sendKeyValueForString:string];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (textField.maxLength == &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; || [string isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;\n&quot;&lt;/span&gt;]) &amp;#123;  &lt;span class=&quot;comment&quot;&gt;// Make sure forms can be submitted via return&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt; allowedLength = textField.maxLength.integerValue - textField.text.length + range.length;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (string.length &amp;gt; allowedLength) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (string.length &amp;gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// Truncate the input string so the result is exactly maxLength&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *limitedString = [string substringToIndex:allowedLength];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;NSMutableString&lt;/span&gt; *newString = textField.text.mutableCopy;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [newString replaceCharactersInRange:range withString:limitedString];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      textField.text = newString;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;// Collapse selection at end of insert to match normal paste behavior&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;UITextPosition&lt;/span&gt; *insertEnd = [textField positionFromPosition:textField.beginningOfDocument&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                                                          offset:(range.location + allowedLength)];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      textField.selectedTextRange = [textField textRangeFromPosition:insertEnd toPosition:insertEnd];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      [textField textFieldDidChange];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;当使用默认的中文拼音的联想输入的时候，并不会走这个&lt;code&gt;delegate&lt;/code&gt;，这个应该是算系统的bug吧，因为测试发现&lt;code&gt;UITextFieldDelegate&lt;/code&gt;的所有方法在此时均不会调用，因此使用&lt;code&gt;UITextFieldDelegate&lt;/code&gt;并不能去限制默认中文输入法的联想输入长度。   &lt;/p&gt;
&lt;p&gt;看来只有从另外的渠道去判断输入的字符是否超过长度，好在这种情况会触发&lt;code&gt;UIControlEventEditingChanged&lt;/code&gt;，因此可以在&lt;code&gt;RCTTextField&lt;/code&gt;的&lt;code&gt;textFieldDidChange&lt;/code&gt;方法中限制输入的长度，如果输入的长度过长则截取。&lt;/p&gt;
&lt;h2 id=&quot;另外的问题&quot;&gt;&lt;a href=&quot;#另外的问题&quot; class=&quot;headerlink&quot; title=&quot;另外的问题&quot;&gt;&lt;/a&gt;另外的问题&lt;/h2&gt;&lt;h3 id=&quot;拼音输入的长度问题&quot;&gt;&lt;a href=&quot;#拼音输入的长度问题&quot; class=&quot;headerlink&quot; title=&quot;拼音输入的长度问题&quot;&gt;&lt;/a&gt;拼音输入的长度问题&lt;/h3&gt;&lt;p&gt;在&lt;code&gt;RCTTextField&lt;/code&gt;的&lt;code&gt;textFieldDidChange&lt;/code&gt;方法中限制输入的长度，可以解决默认中文联想输入过长的问题，但是自己测试就发现了另外的问题😳&lt;br&gt;中文输入的时候打的拼音会被算到&lt;code&gt;text&lt;/code&gt;的长度中，这样就导致了如果只能输入一个字符的时候只能打一个拼音字母了😂&lt;/p&gt;
&lt;p&gt;网上搜索发现中文的blog对限制&lt;code&gt;UITextField&lt;/code&gt;长度的时候都考虑过拼音字母的问题，不会统计拼音字母到字符的长度中。&lt;/p&gt;
&lt;h3 id=&quot;表情截取的问题😃&quot;&gt;&lt;a href=&quot;#表情截取的问题😃&quot; class=&quot;headerlink&quot; title=&quot;表情截取的问题😃&quot;&gt;&lt;/a&gt;表情截取的问题😃&lt;/h3&gt;&lt;p&gt;还有个关键的问题就是表情的截取问题，每个表情😄都是占用的2个字符，简单粗暴的截取就会悲剧😱&lt;/p&gt;
&lt;p&gt;网上都有很多这种类型的blog，只能说下面的这个方法真好使：&lt;br&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//不使用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.text = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.text substringToIndex:_maxLength.unsignedIntegerValue];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//使用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSRange&lt;/span&gt; range = &lt;span class=&quot;built_in&quot;&gt;NSMakeRange&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, _maxLength.unsignedIntegerValue);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSRange&lt;/span&gt; textRange = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.text rangeOfComposedCharacterSequencesForRange:range];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.text = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.text substringWithRange:textRange];&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;另外的坑&quot;&gt;&lt;a href=&quot;#另外的坑&quot; class=&quot;headerlink&quot; title=&quot;另外的坑&quot;&gt;&lt;/a&gt;另外的坑&lt;/h3&gt;&lt;p&gt;当然官方的还有大坑，在判断输入字符的是否超过的限制的时候，&lt;code&gt;allowedLength&lt;/code&gt;是这样求的：&lt;br&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSUInteger&lt;/span&gt; allowedLength = textField.maxLength.integerValue - textField.text.length + range.length;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这个&lt;code&gt;allowedLength&lt;/code&gt;因为是无符号的，所以本来应该是负数的会变的很大很大好么😂&lt;br&gt;如果&lt;code&gt;TextInput&lt;/code&gt;默认设置字符的长度超过了&lt;code&gt;MaxLength&lt;/code&gt;，然后就可以各种玩耍输入了😂&lt;/p&gt;
&lt;p&gt;修这个问题的时候一定得注意如果默认字符超出长度的话得允许删除，不要问我为啥知道😂😂😂&lt;/p&gt;
</content>
    
    <summary type="html">
    
      修改ReactNative的TextInput组件MaxLength错误
    
    </summary>
    
      <category term="iOS" scheme="http://wenzhao.in/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://wenzhao.in/tags/iOS/"/>
    
      <category term="ReactNative" scheme="http://wenzhao.in/tags/ReactNative/"/>
    
  </entry>
  
  <entry>
    <title>折腾Hexo的第一天</title>
    <link href="http://wenzhao.in/first-hexo-day/"/>
    <id>http://wenzhao.in/first-hexo-day/</id>
    <published>2016-05-15T03:55:33.000Z</published>
    <updated>2016-05-15T11:01:34.000Z</updated>
    
    <content type="html">&lt;p&gt;&lt;code&gt;hexo&lt;/code&gt;支持&lt;code&gt;Markdown&lt;/code&gt;，写起来还是蛮顺手的，不过也是各种坑啊@_@   &lt;/p&gt;
&lt;p&gt;一个网页首先少不了的就是图片了&lt;/p&gt;
&lt;p&gt;图片很好说啊，直接&lt;code&gt;Markdown&lt;/code&gt;都有现成的格式引入，&lt;code&gt;hexo&lt;/code&gt;用的是&lt;code&gt;marked&lt;/code&gt;，这个并不支持设置图片的 size，自己不想去手动压缩图片，于是首先想到就是添加对图片 size 设置的支持。&lt;/p&gt;
&lt;h2 id=&quot;图片size的支持&quot;&gt;&lt;a href=&quot;#图片size的支持&quot; class=&quot;headerlink&quot; title=&quot;图片size的支持&quot;&gt;&lt;/a&gt;图片size的支持&lt;/h2&gt;&lt;p&gt;在&lt;code&gt;marked&lt;/code&gt;的 &lt;a href=&quot;https://github.com/chjj/marked/issues/339&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;issues&lt;/a&gt; 中 isiahmeadows 提到了一种去修改&lt;code&gt;Renderer.prototype.image&lt;/code&gt; 这个方法，增加对 size 的解析，然后根据 size 解析出来的参数去设置 &lt;code&gt;img&lt;/code&gt;标签的&lt;code&gt;width&lt;/code&gt;和&lt;code&gt;height&lt;/code&gt;。&lt;br&gt;这个思路不错，copy了他的代码，修改了些许的bug😃，然后重启 &lt;code&gt;hexo&lt;/code&gt;的server，发现图片的&lt;code&gt;height&lt;/code&gt;属性并不能生效😓&lt;br&gt;搜索了下发现是CSS的原因， &lt;code&gt;height&lt;/code&gt;被设置为&lt;code&gt;auto&lt;/code&gt;了&lt;br&gt;其实通常情况下都不会去更改图片的长宽比，那么只需要设置下图片的&lt;code&gt;width&lt;/code&gt;就可以了，于是继续修改&lt;code&gt;markded&lt;/code&gt;，修改设置size的数值的顺序，第一个是width第二个是height。同时修改了下该代码中的解析长宽的正则，可以只写&lt;code&gt;width&lt;/code&gt;&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//原始的&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; exec = &lt;span class=&quot;regexp&quot;&gt;/\s=\s*(\d*)\s*x\s*(\d*)\s*$/&lt;/span&gt;.exec(href)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//修改后的&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; exec = &lt;span class=&quot;regexp&quot;&gt;/\s=\s*(\d*)\s*x?\s*(\d*)\s*$/&lt;/span&gt;.exec(href)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;后面就是开心的只用设置图片的宽度啦~~~&lt;br&gt;赶紧写了第一篇试试，看上去还不错~&lt;/p&gt;
&lt;p&gt;然后从首页点进去，发现了另外的一个坑。&lt;/p&gt;
&lt;h2 id=&quot;图片路径的问题&quot;&gt;&lt;a href=&quot;#图片路径的问题&quot; class=&quot;headerlink&quot; title=&quot;图片路径的问题&quot;&gt;&lt;/a&gt;图片路径的问题&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Markdown&lt;/code&gt;中图片的&lt;code&gt;src&lt;/code&gt;都是和用户写的一样，于是就出现了一个问题，在首页可以显示的图片到了详情页就不能显示了。&lt;br&gt;如果开启了&lt;code&gt;post_asset_folder&lt;/code&gt;的设置，就是详情页可以显示首页不能了。&lt;br&gt;于是继续找文档，发现使用&lt;a href=&quot;https://hexo.io/zh-cn/docs/asset-folders.html#相对路径引用的标签插件&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;相对路径引用的标签&lt;/a&gt;可以解决这个问题。&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;% asset_img   icon.png 图标 %&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;img src=&quot;/first-hexo-day/icon.png&quot; alt=&quot;图标&quot; title=&quot;图标&quot;&gt;
&lt;p&gt;之后就发现一个尴尬的问题，不能设置图片的大小！！！ 前面又白干了。&lt;br&gt;搜索了下发现&lt;code&gt;asset_img&lt;/code&gt;并不支持设置图片大小，于是想学着前面修改&lt;code&gt;Markdown&lt;/code&gt;的方法去修改。&lt;/p&gt;
&lt;p&gt;为了方便自己就只支持&lt;code&gt;width&lt;/code&gt;的设置了，于是首先的问题就是参数放在哪？！因为&lt;code&gt;width&lt;/code&gt;的设置不是必需的，因此就得考虑如何兼容没有设置该属性的时候。如果放在后面的话，官方的代码逻辑会把后面所有的都当成&lt;code&gt;title&lt;/code&gt;，这个逻辑是合理的，因为有的时候我们的&lt;code&gt;title&lt;/code&gt;会包含空格。&lt;br&gt;&lt;code&gt;width&lt;/code&gt;不能放后面的话就放在前面吧，考虑到一个图片的&lt;code&gt;src&lt;/code&gt;不会是纯数字的情况，因此可以通过正则判断的方式来判断第一个参数是否是&lt;code&gt;width&lt;/code&gt;还是&lt;code&gt;src&lt;/code&gt;，于是做了如下的修改：&lt;br&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&#39;use strict&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; url = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&#39;url&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Asset image tag&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Syntax:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; *   &amp;#123;% asset_img slug [title]%&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;ctx&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; PostAsset = ctx.model(&lt;span class=&quot;string&quot;&gt;&#39;PostAsset&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;assetImgTag&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;args&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; slug = args.shift();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//宽度&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; width;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;regexp&quot;&gt;/^\d+$/&lt;/span&gt;.test(slug)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            width = slug;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            slug = args.shift();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!slug) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; asset = PostAsset.findOne(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            post: &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;._id,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            slug: slug&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!asset) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// if title is not assigned, set it &#39;&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; title = args.length ? args.join(&lt;span class=&quot;string&quot;&gt;&#39; &#39;&lt;/span&gt;) : &lt;span class=&quot;string&quot;&gt;&#39;&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// alt always exist&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; alt = title || asset.slug;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (width) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;&amp;lt;img src=&quot;&#39;&lt;/span&gt; + url.resolve(ctx.config.root, asset.path) + &lt;span class=&quot;string&quot;&gt;&#39;&quot; alt=&quot;&#39;&lt;/span&gt; + alt + &lt;span class=&quot;string&quot;&gt;&#39;&quot; title=&quot;&#39;&lt;/span&gt; + title + &lt;span class=&quot;string&quot;&gt;&#39;&quot; width=&quot;&#39;&lt;/span&gt; + width + &lt;span class=&quot;string&quot;&gt;&#39;&quot;&amp;gt;&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;&amp;lt;img src=&quot;&#39;&lt;/span&gt; + url.resolve(ctx.config.root, asset.path) + &lt;span class=&quot;string&quot;&gt;&#39;&quot; alt=&quot;&#39;&lt;/span&gt; + alt + &lt;span class=&quot;string&quot;&gt;&#39;&quot; title=&quot;&#39;&lt;/span&gt; + title + &lt;span class=&quot;string&quot;&gt;&#39;&quot;&amp;gt;&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;后面就可以愉快的设置图片的size了&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;% asset_img  20  icon.png 小图标 %&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;img src=&quot;/first-hexo-day/icon.png&quot; alt=&quot;小图标&quot; title=&quot;小图标&quot; width=&quot;20&quot;&gt;
</content>
    
    <summary type="html">
    
      修改hexo支持图片的size
    
    </summary>
    
      <category term="Web" scheme="http://wenzhao.in/categories/Web/"/>
    
    
      <category term="hexo" scheme="http://wenzhao.in/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>第一篇</title>
    <link href="http://wenzhao.in/hello-world/"/>
    <id>http://wenzhao.in/hello-world/</id>
    <published>2016-05-14T10:30:13.000Z</published>
    <updated>2016-05-15T11:01:48.000Z</updated>
    
    <content type="html">&lt;p&gt;上午本来准备折腾下 &lt;code&gt;hexo&lt;/code&gt;的，结果在刷完6.0的Z3后没有拿稳，然后就悲剧了(＞﹏＜)&lt;br&gt;&lt;img src=&quot;/hello-world/images/z3_screen.jpg&quot; alt=&quot;破碎的屏幕💔&quot; title=&quot;破碎的屏幕💔&quot; width=&quot;400&quot;&gt;&lt;/p&gt;
&lt;p&gt;之后就是拆机评估换屏的难度了，发现z3都开始使用热管了&lt;br&gt;&lt;img src=&quot;/hello-world/images/z3_inside.jpg&quot; alt=&quot;热管散热&quot; title=&quot;热管散热&quot; width=&quot;400&quot;&gt;&lt;/p&gt;
&lt;p&gt;x宝买了个A屏，等收到货后看能否装起来吧。。。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      大法Z3都没有熬过一年😳
    
    </summary>
    
      <category term="Life" scheme="http://wenzhao.in/categories/Life/"/>
    
    
      <category term="life" scheme="http://wenzhao.in/tags/life/"/>
    
  </entry>
  
</feed>
